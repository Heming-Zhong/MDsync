<OCTYPE html>
    <html>

    <head>
        <meta charset="UTF-8">
        <title>Hello World!</title>
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    </head>

    <body>
        <script>
            const en = require('./client-encrypt')
            const rpc = require('./rpc')
            const ipc = require('electron').ipcRenderer
        </script>
        <h1>Hello World！</h1>
        服务端IP:
        <form>
            <input type="text" id="ip" pattern="(25[0-5]|2[0-4]\d|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}$" />
            <br>
            <input type="text" id="port" pattern="^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$" /><br>
            <!-- <input type="submit" id="submitip" onclick="teststub()" /> -->
        </form>
        <script>
            function teststub() {
                ip = document.getElementById("ip").value;
                port = document.getElementById("port").value;
                console.log("send success")
                stub = rpc.getstub(ip, port);
                return stub
            }
        </script>
        请登录:
        <br>
        <input type="text" id="user" /><br>
        <input type="password" id="passwd" /> <br>
        <input type="submit" id="submitacount" onclick="handle()" />
        <script>
            function handle() {
                let username = document.getElementById("user").value;
                let password = document.getElementById("passwd").value;
                user = en.encry(username, "public.pem");
                password = en.encry(password, "public.pem");
                let stub = teststub();
                ipc.send("stub", stub);

                function logincallback(error, response) {
                    if (error) {
                        alert("登录错误:找不到服务器")
                    } else {
                        if (response.status) {
                            alert("登陆成功")
                            ipc.send("loginsuccess", response.uuid)
                        } else {
                            console.log("#debug login error")
                            alert("登陆失败")
                        }
                        rpc.status = response.status
                        if (rpc.status) {} else {}
                    }
                    ipc.send("loginsuccess", 0)
                    console.log(response)
                }

                stub.login({
                    name: user,
                    passwd: password
                }, logincallback)


                //
            }
        </script>
    </body>

    </html>